{% extends 'navbar.html' %}
{% block style %}
<link rel="stylesheet" href="/static/css/recommend-html.css">
<style></style>

{% endblock %}



{% block content %}
<div class="ai-html">
    <div class="ai-top"></div>

    <div class="main-frame">
        <div class="top-frame">
            <div class="arrwos-box">
                <img class="arrwos-box-style" src="/static/img/vector2.svg">
            </div>

            <div class="main-frame-text-style">알송Ai</div>
            
            <div class="arrwos-box">
                <img class="arrwos-box-style" src="/static/img/interface-essential-dots.svg">
            </div>
        </div>

        <div class="pop-text-box">
            <div class="pop-text-1">다음엔 뭐 부르지?🎤 <br>고민된다면! 🤔</div>
            <div class="pop-text-2">우리의 Word2Vec 기반의 개쩌는 모델이<br>담은 곡들을 학습하여 다음에 부를 곡을 골라드려요</div>
        </div>

        <div class="model-box">
            <div class="model-text-box">
                <div class="model-text-1">다음에 코노 가서 부를 곡 추천!</div>

                <div class="img-text-group">
                    <div class="ddabong-img-box">
                        <img class="ellipse-147" src="/static/img/ddabong.png">
                    </div>
                    <div class="text-box">
                        <div class="text-box-text-1">여기도 모델 관련 내용</div>
                        <div class="text-box-text-2">
                            <img  class="clock-style" src="/static/img/clock.svg"> 2분 소요 예정
                        </div>
                    </div>
                </div>

                <div class="reload-box">
                    <div class="reload-text">새로 부를 곡들 추천 받기 ✨</div>
                </div>
            </div>
        </div>

        <div class="main-text">이런 곡을 불러보는 건 어떨까요?</div>

        <div class="recommend-song-box">
            <div class="recommend-song">
                <div class="avatar-05">
                    <img class="ellipse-144" src="/static/img/music.svg">
                </div>
                <div class="recommend-title-artist">
                    <div class="recommend-title-text">곡 제목</div>
                    <div class="recommend-artist-text">가수</div>
                </div>
            </div>
        </div>
        <div class="recommend-song-box">
            <div class="recommend-song">
                <div class="avatar-05">
                    <img class="ellipse-144" src="/static/img/music.svg">
                </div>
                <div class="recommend-title-artist">
                    <div class="recommend-title-text">곡 제목</div>
                    <div class="recommend-artist-text">가수</div>
                </div>
            </div>
        </div>
        <div class="recommend-song-box">
            <div class="recommend-song">
                <div class="avatar-05">
                    <img class="ellipse-144" src="/static/img/music.svg">
                </div>
                <div class="recommend-title-artist">
                    <div class="recommend-title-text">곡 제목</div>
                    <div class="recommend-artist-text">가수</div>
                </div>
            </div>
        </div>
    </div>

</div>

{% endblock %}


{% block script %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    $.ajaxSetup({
        headers: { "X-CSRFToken": '{{csrf_token}}' }
    });
</script>

<script>
    function addToDatabase(kySongNum, tjSongNum, title, artist, cmp, writer) {
        // 선택한 My_folder의 list_number와 list_name 가져오기
        var folderSelect = $("#folderSelect");
        var listNumber = folderSelect.val();
        var listName = folderSelect.find("option:selected").text();

        // AJAX 요청을 생성
        $.ajax({
            type: 'POST',
            url: '/song-list/add-to-database/',
            dataType: 'text',
            headers: {
                "X-CSRFToken": csrftoken
            },
            contentType: 'application/json',
            data: JSON.stringify({
                kySongNum: kySongNum,
                tjSongNum: tjSongNum,
                title: title,
                artist: artist,
                cmp: cmp,
                writer: writer,
                listNumber: listNumber,
                listName: listName
            }),
            success: function(response) {
                var parsedResponse = JSON.parse(response);
                if (parsedResponse.status === 'success') {
                    console.log('데이터 추가 성공');
                    var successMessage = '추가되었습니다.';
                    alert(successMessage)
                } else if (parsedResponse.status === 'error') {
                    console.log('데이터 추가 실패: ' + parsedResponse.message);
                    var errorMessage = '이미 추가된 노래입니다.';
                    alert(errorMessage);
                }
            },
            error: function(xhr, textStatus, errorThrown) {
                console.log('AJAX 요청 실패');
                var errorMessage = 'error';
                alert(errorMessage);
            }
        });

        console.log(data);
    }

    function handleEnterKeyPress(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            $('#search-button').click(); // "로그인" 버튼 클릭 이벤트 발생
        }
    }

    $(document).ready(function () {
        $('#search-query').keypress(handleEnterKeyPress);
        
        $("#search-button").click(function (event) {
            event.preventDefault();

            var query = $("input[name='query']").val();
            var category = $('select[name=search_option]').val();
            var url = '/song-list/search/?category=' + encodeURIComponent(category) + '&query=' + encodeURIComponent(query); // 쿼리 파라미터를 포함한 URL 생성

            console.log(url);

            $.ajax({
                type: 'GET',
                url: url,  // 생성한 URL 사용
                success: function (response) {
                    // 필터링된 노래 리스트를 받아와서 화면에 표시하는 로직 작성
                    window.location.href = url;
                    console.log(response);
                },
            });
        });
    });

    


    document.addEventListener("DOMContentLoaded", function() {
        var urlParams = new URLSearchParams(window.location.search);
        var category = urlParams.get('category');
        var query = urlParams.get('query');
        
        if (category) {
            $('select[name=search_option]').val(category);
        }

        if (query) {
            $("input[name='query']").val(decodeURIComponent(query));
        }
    });


</script>
{% endblock %}

