{% extends 'navbar.html' %}
{% block style %}
<link rel="stylesheet" href="/static/css/recommend-html.css">
<style></style>

{% endblock %}



{% block content %}
<div class="ai-html">
    <div class="ai-top"></div>

    <div class="main-frame">
        <div class="top-frame">
            <a href="/">
                <div class="arrwos-box">
                    <img class="arrwos-box-style" src="/static/img/vector2.svg">
                </div>
            </a>

            <div class="main-frame-text-style">ì•Œì†¡Ai</div>
            
            <div class="arrwos-box">
                <img class="arrwos-box-style" src="/static/img/interface-essential-dots.svg">
            </div>
        </div>

        <div class="pop-text-box">
            <div class="pop-text-1">ë‹¤ìŒì—” ë­ ë¶€ë¥´ì§€?ğŸ¤ <br>ê³ ë¯¼ëœë‹¤ë©´! ğŸ¤”</div>
            <div class="pop-text-2">ìš°ë¦¬ì˜ Word2Vec ê¸°ë°˜ì˜ ê°œì©ŒëŠ” ëª¨ë¸ì´<br>ë‹´ì€ ê³¡ë“¤ì„ í•™ìŠµí•˜ì—¬ ë‹¤ìŒì— ë¶€ë¥¼ ê³¡ì„ ê³¨ë¼ë“œë ¤ìš”</div>
        </div>

        <div class="model-box">
            <div class="model-text-box">
                <div class="model-text-1">ë‹¤ìŒì— ì½”ë…¸ ê°€ì„œ ë¶€ë¥¼ ê³¡ ì¶”ì²œ!</div>

                <div class="img-text-group">
                    <div class="ddabong-img-box">
                        <img class="ellipse-147" src="/static/img/ddabong.png">
                    </div>
                    <div class="text-box">
                        <div class="text-box-text-1">ì¶”ì²œ ëª¨ë¸ì€ í…ŒìŠ¤íŠ¸ ì¤‘ì…ë‹ˆë‹¤!</div>
                        <div class="text-box-text-2">
                            ì¶”ì²œ ê²°ê³¼ê°€ ì´ìƒí•  ìˆ˜ ìˆì–´ìš” ã…ã…..
                        </div>
                    </div>
                </div>

                <div class="reload-box">
                    <div class="reload-text">
                        <button class="recommend-button button-add-list" id="button-add-list">
                        ìƒˆë¡œ ë¶€ë¥¼ ê³¡ë“¤ ì¶”ì²œ ë°›ê¸° âœ¨
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-text">ì´ëŸ° ê³¡ì„ ë¶ˆëŸ¬ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”?</div>
        <!-- <div class="recommend-song-box">
            <div class="recommend-song">
                <div class="avatar-05">
                    <img class="ellipse-144" src="/static/img/music.svg">
                </div>
                <div class="recommend-title-artist">
                    <div class="recommend-title-text">ê³¡ ì œëª©</div>
                    <div class="recommend-artist-text">ê°€ìˆ˜</div>
                </div>
            </div>
        </div> -->
    </div>
</div>


<!-- ë¦¬ìŠ¤íŠ¸ì— ë…¸ë˜ ì¶”ê°€í•˜ëŠ” ëª¨ë‹¬ -->
<div id="modal-add-song" class="modal modal-overlay-song">
    <div class="modal_window">
        <div class="modal_title">ì¶”ì²œ ë°›ì„ í´ë” ì„ íƒí•˜ê¸°
            <div class="modal-title-side"></div>
            <div class="modal-title-side">
                <span id="close_modal" class="close_modal material-icons-outlined" style="font-size: large;">
                    X
                </span>
            </div>
        </div>
        <div class="modal-mylist">
            {% for folder in folders %}
            <li>
                <div class="popup_list list_button" id="folderSelect" data-list-number="{{folder.list_number}}">
                    <div class="popup_list-thumbnail">
                        <img src="/static/img/music.svg">
                    </div>
                    <div class="popup_list-text">
                        <p class="popup_list-title list-name"> {{folder.list_name}} </p>
                        <p class="popup_list-count"> {{folder.song_count}} </p>
                    </div>
                </div>
            </li>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}


{% block script %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    $.ajaxSetup({
        headers: { "X-CSRFToken": '{{csrf_token}}' }
    });
</script>

<script>
    function addToDatabase(kySongNum, tjSongNum, title, artist, cmp, writer) {
        // ì„ íƒí•œ My_folderì˜ list_numberì™€ list_name ê°€ì ¸ì˜¤ê¸°
        var folderSelect = $("#folderSelect");
        var listNumber = folderSelect.val();
        var listName = folderSelect.find("option:selected").text();

        // AJAX ìš”ì²­ì„ ìƒì„±
        $.ajax({
            type: 'POST',
            url: '/song-list/add-to-database/',
            dataType: 'text',
            headers: {
                "X-CSRFToken": csrftoken
            },
            contentType: 'application/json',
            data: JSON.stringify({
                kySongNum: kySongNum,
                tjSongNum: tjSongNum,
                title: title,
                artist: artist,
                cmp: cmp,
                writer: writer,
                listNumber: listNumber,
                listName: listName
            }),
            success: function(response) {
                var parsedResponse = JSON.parse(response);
                if (parsedResponse.status === 'success') {
                    console.log('ë°ì´í„° ì¶”ê°€ ì„±ê³µ');
                    var successMessage = 'ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    alert(successMessage)
                } else if (parsedResponse.status === 'error') {
                    console.log('ë°ì´í„° ì¶”ê°€ ì‹¤íŒ¨: ' + parsedResponse.message);
                    var errorMessage = 'ì´ë¯¸ ì¶”ê°€ëœ ë…¸ë˜ì…ë‹ˆë‹¤.';
                    alert(errorMessage);
                }
            },
            error: function(xhr, textStatus, errorThrown) {
                console.log('AJAX ìš”ì²­ ì‹¤íŒ¨');
                var errorMessage = 'error';
                alert(errorMessage);
            }
        });

        console.log(data);
    }

    function handleEnterKeyPress(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            $('#search-button').click(); 
        }
    }

    $(document).ready(function () {
        $('#search-query').keypress(handleEnterKeyPress);
        
        $("#search-button").click(function (event) {
            event.preventDefault();

            var query = $("input[name='query']").val();
            var category = $('select[name=search_option]').val();
            var url = '/song-list/search/?category=' + encodeURIComponent(category) + '&query=' + encodeURIComponent(query); // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ í¬í•¨í•œ URL ìƒì„±

            console.log(url);

            $.ajax({
                type: 'GET',
                url: url,  // ìƒì„±í•œ URL ì‚¬ìš©
                success: function (response) {
                    // í•„í„°ë§ëœ ë…¸ë˜ ë¦¬ìŠ¤íŠ¸ë¥¼ ë°›ì•„ì™€ì„œ í™”ë©´ì— í‘œì‹œí•˜ëŠ” ë¡œì§ ì‘ì„±
                    window.location.href = url;
                    console.log(response);
                },
            });
        });
    });


    document.querySelector('body').addEventListener('click', (e) => {
        // Check if the clicked element has the 'popup_list' class
        if (e.target.closest('.popup_list')) {
            var folderElement = e.target.closest('.popup_list');
            var listNumber = folderElement.getAttribute('data-list-number');
            var listName = folderElement.querySelector('.list-name').textContent.trim();


            // Merge the song and folder data into one object
            var sendData = Object.assign({}, { listNumber, listName });

            

            $.ajax({
            type: 'POST',
            url: '/recommend/process/',
            dataType: 'json',
            headers: {
                "X-CSRFToken": csrftoken
            },
            contentType: 'application/json',
            data: JSON.stringify(sendData),
            
            success: function(response) {
                const jsonResponse = response;

                if (jsonResponse.status === 'success') {
                    console.log('ë°ì´í„° ì „ì†¡ ì™„ë£Œ');
                    var successMessage = 'ì¶”ì²œ ëª¨ë¸ ëŒì•„ê°€ëŠ” ì¤‘';
                    alert(successMessage);
                } else if (jsonResponse.status === 'error') {
                    console.log('ë°ì´í„° ì „ì†¡ ì‹¤íŒ¨: ' + jsonResponse.message);
                    var errorMessage = 'ì¶”ì²œ ëª¨ë¸ ì˜¤ë¥˜ ë°œìƒ';
                    alert(errorMessage);
                }
            },
            error: function(xhr, textStatus, errorThrown) {
                console.log('AJAX ìš”ì²­ ì‹¤íŒ¨');
                var errorMessage = 'error';
                alert(errorMessage);
            }
        });


            console.log(sendData);
        }
    });


    document.addEventListener("DOMContentLoaded", function() {
        var urlParams = new URLSearchParams(window.location.search);
        var category = urlParams.get('category');
        var query = urlParams.get('query');
        
        if (category) {
            $('select[name=search_option]').val(category);
        }

        if (query) {
            $("input[name='query']").val(decodeURIComponent(query));
        }
    });

    // ëª¨ë“  ë¦¬ìŠ¤íŠ¸ ë²„íŠ¼ì— ëŒ€í•´ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡
    const listButtons = document.querySelectorAll(".list_button");
    listButtons.forEach((listButton) => {
        listButton.addEventListener('click', () => {
            const listNumber = listButton.dataset.listNumber;
            const url = `/recommend/${listNumber}/`; // ì´ë™í•  URL ì„¤ì •
            window.location.href = url; // URLë¡œ ì´ë™
        });
    });


    //ëª¨ë‹¬ ë„ìš°ê¸° ì½”ë“œ
    const modal = document.getElementById("modal-add-song");
    const buttonsAddList = document.querySelectorAll(".recommend-button");

    buttonsAddList.forEach(button => {
        button.addEventListener("click", e => {
            modal.style.top = window.pageYOffset + 'px'; // ëª¨ë‹¬ ì°½ì´ ìŠ¤í¬ë¡¤ì— ë”°ë¼ ì›€ì§ì´ë„ë¡ ìœ„ì¹˜ ì„¤ì •
            modal.style.display = "flex";
            document.body.style.overflowY = "hidden"; // ìŠ¤í¬ë¡¤ ì—†ì• ê¸°

            console.log(window.pageYOffset + " ìœ„ì¹˜"); // ìœ„ì¹˜ ë¡œê·¸ ì°ê¸°
        });
    });


    //ëª¨ë‹¬ ë‹«ê¸° ì½”ë“œ
    const buttonCloseModal = 
    document.getElementById("close_modal");
    buttonCloseModal.addEventListener("click", e => {
        modal.style.display = "none";
        document.body.style.overflowY = "visible";
    });


</script>
{% endblock %}

