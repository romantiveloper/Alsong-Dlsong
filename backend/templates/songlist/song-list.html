{% extends 'navbar.html' %}
{% block style %}

<link rel="stylesheet" href="/static/css/song-list-html2.css">

{% endblock %}
{% block content %}

<div class="song-list-html">
    <div class="rectangle-6"></div>

    <div class="main-frame">
        <div class="top-frame">
            <div class="arrwos-box">
                <img class="arrwos-box-style" src="/static/img/vector2.svg">
            </div>

            <div class="main-frame-text-style">ì¸ê¸°ì°¨íŠ¸</div>
            
            <div class="arrwos-box">
                <img class="arrwos-box-style" src="/static/img/interface-essential-dots.svg">
            </div>
        </div>

        <div class="pop-text-box">
            <div class="pop-text-1">í˜„ì¬ ë…¸ë˜ë°©ì˜<br> ì¸ê¸°ì°¨íŠ¸ğŸ…ë¥¼ í™•ì¸í•˜ì„¸ìš”!</div>
            <div class="pop-text-2">ë…¸ë˜ë°© ê¸°ê³„ì˜ ì¸ê¸°ì°¨íŠ¸ë¥¼<br> ì•Œì†¡ë‹¬ì†¡ì—ì„œ ë°”ë¡œ í™•ì¸í•˜ê³  ë‚´ ë¦¬ìŠ¤íŠ¸ì— ë‹´ì•„ ë³´ì„¸ìš”</div>
        </div>

        <div class="logo-box">
            <div class="logo-box-style"></div>
            <button class="tj-box-style">
                <a href="/song-list/">
                    <img src="/static/img/tj-removebg-preview-2.png">
                </a>
            </button>
            <button class="ky-box-style">
                <a href="/song-list/ky/">
                    <img src="/static/img/ky-1.png">
                </a>
            </button>
        </div>
    </div>

    <div class="song-box">
        <div class="song-box-head">
            <div class="song-box-head-text">
                <div style="width: 24px;">ìˆœìœ„</div>
                <div style="width: 80px;">ê³¡ëª…</div>
                <div style="width: 80px;">ì•„í‹°ìŠ¤íŠ¸</div>
                <div style="width: 53px;">TJê³¡ë²ˆí˜¸</div>
                <div style="width: 24px;">ë‹´ê¸°</div>
            </div>
        </div>

        <div class="song-box-body">
            {% for song in songs %}
            <div class="song-list">
                <div class="rank">{{song.rank}}</div>
                <div class="title-text">{{song.title}}</div>
                <div class="artist-text">{{song.artist}}</div>
                <div class="tj">{{song.song_num_id}}</div>
                <div class="ellipse-12">
                    <button class="ellipse-12 button-add-list" id="button_add_list"
                            song_num_id="{{song.song_num_id}}">
                        <img style="width: 18px; height: 18px;" src="/static/img/icon-add.svg">
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>



</div>

<!-- ë¦¬ìŠ¤íŠ¸ì— ë…¸ë˜ ì¶”ê°€í•˜ëŠ” ëª¨ë‹¬ -->
<div id="modal-add-song" class="modal modal-overlay-song">
    <div class="modal_window">
        <div class="modal_title">ë‚´ ë¦¬ìŠ¤íŠ¸ì— ë‹´ê¸°
            <div class="modal-title-side"></div>
            <div class="modal-title-side">
                <span id="close_modal" class="close_modal material-icons-outlined" style="font-size: large;">
                    X
                </span>
            </div>
        </div>
        <div class="modal-mylist">
            {% for folder in folders %}
            <li>
                <div class="popup_list" id="folderSelect" data-list-number="{{folder.list_number}}">
                    <div class="popup_list-thumbnail">
                        <img src="/static/img/music.svg">
                    </div>
                    <div class="popup_list-text">
                        <p class="popup_list-title list-name"> {{folder.list_name}} </p>
                        <p class="popup_list-count"> {{folder.song_count}} </p>
                    </div>
                </div>
            </li>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}


{% block script %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>    

    document.querySelector('body').addEventListener('click', (e) => {
        // Check if the clicked element has the 'button-add-list' class
        if (e.target.closest('.button-add-list')) {
            var button = e.target.closest('.button-add-list');
            // Assign song data on selectedSongData
            selectedSongData = {
                song_num_id: button.getAttribute('song_num_id')
            };
        }
    });

    document.querySelector('body').addEventListener('click', (e) => {
        // Check if the clicked element has the 'popup_list' class
        if (e.target.closest('.popup_list')) {
            var folderElement = e.target.closest('.popup_list');
            var listNumber = folderElement.getAttribute('data-list-number');
            var listName = folderElement.querySelector('.list-name').textContent.trim();

            // Merge the song and folder data into one object
            var sendData = Object.assign({}, selectedSongData, { listNumber, listName });

            $.ajax({
            type: 'POST',
            url: '/song-list/add-to-tjlist/',
            dataType: 'text',
            headers: {
                "X-CSRFToken": csrftoken
            },
            contentType: 'application/json',
            data: JSON.stringify(sendData),
            success: function(response) {
                var parsedResponse = JSON.parse(response);
                if (parsedResponse.status === 'success') {
                    console.log('ë°ì´í„° ì¶”ê°€ ì„±ê³µ');
                    location.reload();
                    var successMessage = 'ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    alert(successMessage)
                } else if (parsedResponse.status === 'error') {
                    console.log('ë°ì´í„° ì¶”ê°€ ì‹¤íŒ¨: ' + parsedResponse.message);
                    var errorMessage = 'ì´ë¯¸ ì¶”ê°€ëœ ë…¸ë˜ì…ë‹ˆë‹¤.';
                    alert(errorMessage);
                }
            },
            error: function(xhr, textStatus, errorThrown) {
                console.log('AJAX ìš”ì²­ ì‹¤íŒ¨');
                var errorMessage = 'error';
                alert(errorMessage);
            }
        });

            console.log(data);
        }
    });


    $(document).ready(function() {
        $("button").click(function() {
            var category = $(this).val();  // ë²„íŠ¼ì˜ ê°’(category)ì„ ê°€ì ¸ì˜´
            var query = $("input[name='query']").val();  // ê²€ìƒ‰ì–´ë¥¼ ê°€ì ¸ì˜´
            var folderSelect = $("#folderSelect");


            $.ajax({
                type: 'POST',
                url: '/song-list/',
                data: {
                    'category': category,
                    'query': query,  // ê²€ìƒ‰ì–´(query)ë¥¼ ë°ì´í„°ì— í¬í•¨ì‹œí‚´
                },
                success: function(response) {
                    // í•„í„°ë§ëœ ë…¸ë˜ ë¦¬ìŠ¤íŠ¸ë¥¼ ë°›ì•„ì™€ì„œ í™”ë©´ì— í‘œì‹œí•˜ëŠ” ë¡œì§ ì‘ì„±
                    console.log(response);
                }
            });
        });
    });

    $.ajaxSetup({
        headers: { "X-CSRFToken": csrftoken }
    });

    //ëª¨ë‹¬ ë„ìš°ê¸° ì½”ë“œ
    const modal = document.getElementById("modal-add-song");
    const buttonsAddList = document.querySelectorAll(".ellipse-12");

    buttonsAddList.forEach(button => {
        button.addEventListener("click", e => {
            modal.style.top = window.pageYOffset + 'px'; // ëª¨ë‹¬ ì°½ì´ ìŠ¤í¬ë¡¤ì— ë”°ë¼ ì›€ì§ì´ë„ë¡ ìœ„ì¹˜ ì„¤ì •
            modal.style.display = "flex";
            document.body.style.overflowY = "hidden"; // ìŠ¤í¬ë¡¤ ì—†ì• ê¸°

            console.log(window.pageYOffset + " ìœ„ì¹˜"); // ìœ„ì¹˜ ë¡œê·¸ ì°ê¸°
        });
    });


    //ëª¨ë‹¬ ë‹«ê¸° ì½”ë“œ
    const buttonCloseModal = 
    document.getElementById("close_modal");
    buttonCloseModal.addEventListener("click", e => {
        modal.style.display = "none";
        document.body.style.overflowY = "visible";
    });

    

</script>

{% endblock %}
