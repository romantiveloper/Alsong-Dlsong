{% extends 'navbar.html' %}
{% block style %}


<!-- jquery ì‚¬ìš©í•˜ê¸° ìœ„í•´ -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/95c5c08857.js" crossorigin="anonymous"></script>

<style>
    li, ol, ul{
        list-style: none;
    }

    .modal {
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(1.5px);
        -webkit-backdrop-filter: blur(1.5px);
    }

    .modal_window {
        background: white;
        backdrop-filter: blur(13.5px);
        -webkit-backdrop-filter: blur(13.5px);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        width: 300px;
        height: 200px;
        position: relative;
    }

    .modal_title{
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        font-weight: bold;
        font-size: 10px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.18);
    }

    .modal_title_side{
        margin: 5px;
        flex: 0 0 40px;
        text-align: center;
    }

    .modal_content_write{
        display: flex;
        flex-direction: column;
        border-left: 1px solid rgba(0, 0, 0, 0.18);;
    }

    .feed_content_textarea{
        resize: none;
        width: 294px;
        border: none;
    }

    /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    .dashboard_container,
    .list_container {
        max-width: 700px;
        width: 100%;
        margin: 0 auto;
    }

    .list_container {
        flex-wrap: wrap;
        background-color: white;
        display: flex;
    }

    .list_item {
        background-color: aliceblue;
        width: 150px;
        max-width: 150px;
        margin: 10px;
        display: flex;
    }

    .list_name {
        position: relative;
        z-index: 10;
        padding-top: 0px;
        padding-left: auto;
        width: 170px;
        text-align: center;
    }

    @media screen and (max-width: 767px) {
    /* ë¸Œë¼ìš°ì €ê°€ 767px ì´í•˜ì¼ ë•Œ ì ìš©ë˜ëŠ” ìŠ¤íƒ€ì¼ */
    .dashboard_container,
    .list_container {
            padding-left: 20px;
            padding-right: 20px;
            display: flex;
            margin: 20px auto; 
        }
    }

    @media screen and (max-width: 480px) {
    /* ë¸Œë¼ìš°ì €ê°€ 480px ì´í•˜ì¼ ë•Œ ì ìš©ë˜ëŠ” ìŠ¤íƒ€ì¼ */
    .dashboard_container,
    .list_container {
        padding-left: 10px;
        padding-right: 10px;
        background-color: white;
        display: flex;
        margin: 0 auto; 
        justify-content: space-evenly;
    }

    .list_item {
        flex-basis: 100%;
    }}


    .list_button {
        background-image: url("/static/img/music-book.png");
        background-size: cover; /* ì´ë¯¸ì§€ë¥¼ ë²„íŠ¼ì— ë§ê²Œ ì¡°ì ˆí•©ë‹ˆë‹¤. */
        background-position: center; /* ì´ë¯¸ì§€ë¥¼ ê°€ìš´ë°ë¡œ ì •ë ¬í•©ë‹ˆë‹¤. */
    }

    .button-add-list {
        background-image: url("/static/img/add-button.png");
        background-size: cover; /* ì´ë¯¸ì§€ë¥¼ ë²„íŠ¼ì— ë§ê²Œ ì¡°ì ˆí•©ë‹ˆë‹¤. */
        background-position: center; /* ì´ë¯¸ì§€ë¥¼ ê°€ìš´ë°ë¡œ ì •ë ¬í•©ë‹ˆë‹¤. */
    }
   
    .logo-box {
        display: flex;
        width: 108px; 
        height: 39px; 
        background: white; 
        border-radius: 15px;
        justify-content: space-around;
        position: relative;
        margin: 0 auto;
    }

    .logo-text {
        display: flex;
        text-align: center; 
        color: black; 
        font-size: 12px; 
        font-family: Inter; 
        font-weight: 500; 
        word-wrap: break-word;
        align-items: center;
    }

    .main-box {
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        gap: 17px;
        padding-top: 18px;
        padding-left: 10px;
        padding-right: 10px;
        margin: 0 auto;
        position: relative;
        width: 100%;
    }

    .searchbar {
        display: flex;
        width:80%;
        height: 39px;
        flex-shrink: 0;
        border-radius: 20px;
        background: var(--ui-white, #FFF);
        position: relative;
        align-items: center;
    }

    .search-img {
        width: 14px;
        height: 14px;
        flex-shrink: 0;
        position: relative;
        padding-left: 15px;
    }

    .search-text {
        text-align: center;
        color: #B0B0B1;
        font-size: 12px;
        font-family: Inter;
        font-weight: 300;
        word-wrap: break-word;
        padding-left: 33px;
    }

    .main-banner {
        width: 100%;
        height: 137px;
        position: relative;
    }

    .dashboard {
        width: 100%; 
        height: 137px; 
        background: #45D3B1; 
        border-radius: 20px;
        left: 0px;
        top: 0px;
        position:absolute;
    }

    .banner-profile {
        width: 100%;
        height: 95px;
        left: 24px;
        top: 21px;
        position: absolute;
    }
    
    .profile-img-box {
        width: 95px; 
        height: 95px; 
        left: 0px; 
        top: 0px; 
        position: absolute
    }

    .profile-img {
        width: 95px; 
        height: 95px; 
        left: 0px; 
        top: 0px; 
        position: absolute; 
        background: #F6F7FD;
        border-radius: 50%;
    }

    .Dicons {
        width: 56px;
        height: 72px;
        left: 20px;
        top: 12px;
        position: absolute;
        flex-direction: column; 
        justify-content: center; 
        align-items: center; 
        display: inline-flex;
    }

    .frame-25 {
        display: flex;
        flex-direction: row;
        gap: 5px;
        align-items: center;
        justify-content: flex-start;
        position: relative;
        padding-left: 134px;
        padding-top: 20px;
    }

    .frame-25-text-1 {
        color: #ffffff;
        text-align: center;
        font: 400 20px "Noto Sans", sans-serif;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .frame-25-text-2 {
        color: #4c5057;
        text-align: left;
        font: 500 12px "Noto Sans", sans-serif;
        position: relative;
        display: flex;
        align-items: flex-end;
        justify-content: flex-start;
    }

    .frame-1992 {
        display: flex;
        flex-direction: row;
        gap: 5px;
        align-items: center;
        justify-content: flex-start;
        position: relative;
        padding-left: 134px;
    }

    .group-25 {
        flex-shrink: 0;
        width: 190px;
        height: 44px;
        position: static;
        display: flex;
    }

    .frame-1992-text-1 {
        color: var(--sub, #37385e);
        text-align: center;
        font: 400 15px "Noto Sans", sans-serif;
        position: relative;
        left: 0px;
        top: 14px;
        width: 90px;
        display: flex;
        justify-content: flex-start;
    }

    .frame-1992-text-2 {
        color: var(--main, #1e1f4b);
        text-align: center;
        font: 400 32px "Noto Sans", sans-serif;
        position: relative;
        left: 0px;
        top: 0px;
        width: 49px;
        display: flex;
        align-items: flex-end;
        justify-content: center;
    }

    .frame-1992-text-3 {
        color: var(--sub, #37385e);
        text-align: center;
        font: 400 15px "Noto Sans", sans-serif;
        position: relative;
        left: 0px;
        top: 14px;
        width: 14px;
        display: flex;
        justify-content: flex-start;
    }

    .vector {
        flex-shrink: 0;
        position: relative;
        overflow: visible;
    }

    .recommend-banner,
    .recommend-banner * {
        box-sizing: border-box;
    }

    .recommend-banner {
        width: 100%;
        height: 60px;
        position: relative;
        background: var(--ui-white, #ffffff);
        border-radius: 20px;
    }

    .recommend-banner-design {
        background: var(--ui-white, #ffffff);
        border-radius: 20px;
        width: 100%;
        height: 60px;
        position: absolute;
        left: 0px;
        top: 0px;
    }

    .recommend-title {
        border-radius: 30px;
        padding: 0px 15px 0px 15px;
        display: flex;
        flex-direction: row;
        gap: 134px;
        align-items: center;
        justify-content: flex-start;
        width: 100%;
        position: absolute;
        left: 11px;
        top: 13px;
    }

    .ai {
        color: #000000;
        text-align: left;
        font: var(--bold-15-pt, 400 15px "Noto Sans", sans-serif);
        position: relative;
    }

    .frame-4 {
        padding: 10px;
        display: flex;
        flex-direction: row;
        gap: 10px;
        align-items: flex-start;
        justify-content: flex-start;
        flex-shrink: 0;
        position: relative;
        overflow: visible;
    }

    .folder-box,
    .folder-box * {
        box-sizing: border-box;
    }
    .folder-box {
        flex-shrink: 0;
        width: 100%;
        height: auto;
        position: relative;
        display: flex;
        justify-content: space-around;
    }

    .folder-box-design {
        background: var(--ui-white, #ffffff);
        border-radius: 20px;
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0px;
        top: 0px;
    }

    .folder-box-title {
        padding: 0px 15px 0px 15px;
        display: flex;
        flex-direction: row;
        gap: 203px;
        align-items: flex-end;
        justify-content: flex-start;
        width: 100%;
        position: absolute;
        left: 11px;
        top: 14px;
    }

    .folder-box-title-text {
        color: #000000;
        text-align: left;
        font: var(--bold-15-pt, 400 15px "Noto Sans", sans-serif);
        position: relative;
    }

    .folder {
        flex-shrink: 0;
        width: 155px;
        height: 140px;
        display: flex;
        background: #45d3b1;
        border-radius: 20px;
        margin: 5px;
    }

    .folder-design {
        background: #45d3b1;
        border-radius: 20px;
        width: 136px;
        height: 135.77px;
        left: 0px;
        top: 0px;
    }

    .group-24 {
        width: 136px;
        height: 161px;
        left: 0px;
        top: 0px;
    }
    
    .folder-name-1 {
        color: #ffffff;
        text-align: left;
        font: 700 15px "Noto Sans KR", sans-serif;
        left: 19.26px;
        top: 8.41px;
        width: 89.06px;
        height: 45.66px;
        display: flex;
        align-items: flex-end;
        justify-content: flex-start;
        padding-left: 15px;
    }

    .folder-name-2 {
        color: #8d94a0;
        text-align: left;
        font: 700 15px "Noto Sans KR", sans-serif;
        left: 19.26px;
        top: 8.41px;
        width: 110px;
        height: 45.66px;
        display: flex;
        align-items: flex-end;
        justify-content: flex-start;
        padding-left: 15px;
    }

    .folder-in-song {
        color: #ffffff;
        text-align: left;
        font: 500 12px "Noto Sans KR", sans-serif;
        /* position: absolute; */
        width: auto;
        height: 45.66px;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        padding-top: 60px;
        padding-left: 15px;
    }

    .ellipse-11,
    .ellipse-11 * {
        box-sizing: border-box;
    }
    .ellipse-11 {
        background: var(--sub, #37385e);
        border-radius: 50%;
        width: 37.31px;
        height: 37.25px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: space-around;
        
    }
    ._3-dicons,
    ._3-dicons * {
        box-sizing: border-box;
    }
    ._3-dicons {
        width: 22.87px;
        height: 20.32px;
        position: relative;
    }
    ._3-dicons2 {
        width: 22.87px;
        height: 20.32px;
        position: absolute;
        left: 0px;
        top: 0px;
    }

</style>
{% endblock %}


{% block content %}
<div class="home">
    <div class="main">
        <div class="logo-box">
            <div class="logo-text">
                ì•Œì†¡ë‹¬ì†¡<br/>ë¡œê³ 
            </div>
        </div>

        <div class="main-box">
            <div class="searchbar">
                <div class="search-img">
                    <img src="/static/img/icon-search-normal-1.svg">
                </div>
                <div class="search-text">
                    ë¶€ë¥´ê³  ì‹¶ì€ ê³¡ì„ ê²€ìƒ‰í•˜ì„¸ìš”!
                </div>
            </div>
            
            <div class="main-banner">
                <div class="dashboard"></div>
                <div class="banner-profile">

                    <div class="profile-img-box">
                        <div class="profile-img">
                            <div class="Dicons">
                                <img style="width: 56px; height: 72px" src="/static/img/music.svg" />
                            </div>
                        </div>
                    </div>
                    {% for users in user %}
                    <div class="frame-25">
                        <div class="frame-25-text-1">{{users.nickname}}</div>
                        <div class="frame-25-text-2">ë‹˜ ì•ˆë…•í•˜ì„¸ìš” ğŸ¶</div>
                    </div>
                    {% endfor %}
                    <div class="frame-1992">
                        <div class="group-25">
                            <div class="frame-1992-text-1">ì´ ë‹¬ë¦° ê³¡</div>
                            {% with total_song_count=0 %}
                                {% for list in folder_list %}
                                    {% with new_total_song_count=total_song_count|add:list.song_count %}
                                        {% with total_song_count=new_total_song_count %}
                                        {% endwith %}
                                    {% endwith %}
                                {% endfor %}
                                <div class="frame-1992-text-2">{{ total_song_count }}</div>
                            {% endwith %}
                            <div class="frame-1992-text-3">ê³¡</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="recommend-banner">
                <div class="recommend-title">
                    <div class="ai">Ai ë¶€ë¥¼ê³¡ ì¶”ì²œ ë°›ê¸°!</div>
                    <img class="frame-4" src="/static/img/vector.svg">
                </div>
            </div>

            <div class="folder-box">
                <div class="folder-box-design"></div>
                <div class="folder-box-title">
                    <div class="folder-box-title-text">ë‹¬ì†¡ í´ë”</div>
                </div>

                <div class="folder-box" style="margin-top: 50px; margin-bottom: 20px; justify-content: space-around; flex-direction: row; flex-wrap: wrap; width: calc(2*168px + 2*1vw);">
                    {% for list in folder_list %}
                    <div class="folder list_button" data-list-number="{{ list.list_number }}">
                        <div>
                            <div class="folder-name-1">{{list.list_name}}</div>
                            <div class="folder-in-song">{{list.song_count}} ê³¡</div>
                        </div>
                        <div style="padding-top: 80px; padding-left: 20px;">
                            <div class="ellipse-11">
                                <div class="_3-dicons">
                                    <img class="_3-dicons2" src="/static/img/mic-dicons.png" />
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    <div class="folder" id="button_add_list">
                        <div class="folder-name-2">ìƒˆ í´ë” ì¶”ê°€</div>
                        <div style="padding-top: 80px; padding-right: 10px;">
                            <div class="ellipse-11">
                                <div class="_3-dicons">
                                    <img class="_3-dicons2" src="/static/img/add-dicons.png" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<!-- ëª¨ë‹¬ content ë¶€ë¶„-->
<div id="modal_add_feed_content" class="modal modal_overlay_content">
    <div class="modal_window">
        <div class="modal_title">
            <div class="modal_title_side"></div>
            <div class="modal_title_side">
                <span id="close_modal" class="close_modal material-icons-outlined" style="font-size: 15px">
                    X
                </span>
            </div>
        </div>
        <div class="modal_content_write">
            <div style="height: 150px">
                <textarea id="input_list_name" class="feed_content_textarea form-control col-sm-5" rows="10" placeholder="ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <div style="width: 100%; text-align: center">
                <button id="button_write_feed" type="button" class="btn btn-primary" style="width: 268px"> ì¶”ê°€í•˜ê¸°</button>
            </div>
        </div>
    </div>
</div>


{% endblock %}

{% block script %}
<script>    
    $.ajaxSetup({
        headers: { "X-CSRFToken": '{{csrf_token}}' }
    });
</script>

<script>
    //ëª¨ë‹¬ ë„ìš°ê¸° ì½”ë“œ
    const modal = document.getElementById("modal_add_feed_content");
    const buttonAddFeed = document.getElementById("button_add_list");
    buttonAddFeed.addEventListener("click", e=> {
        modal.style.top = window.pageYOffset + 'px'; // topì„ ì´ìš©í•´ ì‹œì‘ y ìœ„ì¹˜ë¥¼ ë°”ê¿”ì¤Œ
        modal.style.display = "flex";
        document.body.style.overflowY = "hidden"; //ìŠ¤í¬ë¡¤ ì—†ì• ê¸°

        console.log(window.pageYOffset + " ìœ„ì¹˜"); //ë¡œê·¸ ì°ê¸°
    });

    //ëª¨ë‹¬ ë‹«ê¸° ì½”ë“œ
    const buttonCloseModal = 
    document.getElementById("close_modal");
    buttonCloseModal.addEventListener("click", e => {
        modal.style.display = "none";
        document.body.style.overflowY = "visible";
    });

    let listCount = 0; // ì¶”ê°€ëœ ë¦¬ìŠ¤íŠ¸ ê°œìˆ˜ë¥¼ ì¶”ì í•˜ê¸° ìœ„í•œ ë³€ìˆ˜

    

    function addList(fd) {
        $.ajax({
            url: 'add_list/', // ë°ì´í„°ë¥¼ ì „ì†¡í•  URL
            type: 'POST', // POST ë©”ì„œë“œ ì‚¬ìš©
            data: fd, // FormDataë¥¼ ì „ì†¡ ë°ì´í„°ë¡œ ì‚¬ìš©
            processData: false, // FormDataë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì§€ ì•ŠìŒ
            contentType: false, // ì»¨í…ì¸  ìœ í˜•ì„ ì„¤ì •í•˜ì§€ ì•ŠìŒ
            headers:{
                'X-CSRFToken':csrftoken
            },
            success: function(response) {
                // ì„±ê³µì ìœ¼ë¡œ ì‘ë‹µì„ ë°›ì•˜ì„ ë•Œ ì‹¤í–‰í•  ì½”ë“œ
                console.log(response);

                // ìƒˆë¡œìš´ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•˜ëŠ” ì½”ë“œ
                const newList = `
                    <div style="background-color: aliceblue; width: 150px; margin: 10px; height: 150px; display: flex; justify-content: center; align-items: center;">
                        <span>${list_name}</span>
                    </div>
                `;

                $('#list_container').append(newList);
                listCount++;

                // ì¶”ê°€ ë²„íŠ¼ì„ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™í•˜ëŠ” ì½”ë“œ
                const buttonWidth = 170; // ì¶”ê°€ ë²„íŠ¼ì„ ê°ì‹¸ëŠ” <div> ìš”ì†Œì˜ ë„ˆë¹„ + ë§ˆì§„ê°’
                const containerWidth = 700; // ë¦¬ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆì˜ ë„ˆë¹„
                const maxButtonsPerRow = Math.floor(containerWidth / buttonWidth);

                if (listCount % maxButtonsPerRow === 0) {
                    $('#button_add_list').css('float', 'left');
                }

                //location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì¶”ê°€
            },
            error: function(xhr, errmsg, err) {
                // ìš”ì²­ì´ ì‹¤íŒ¨í–ˆì„ ë•Œ ì‹¤í–‰í•  ì½”ë“œ
                console.log(xhr.status + ": " + xhr.responseText);
                var errorMessage = "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.";
                alert(errorMessage);
            }
        });
    }

    $('#button_write_feed').on('click', () => {
        const list_name = $('#input_list_name').val();

        let fd = new FormData();

        fd.append('list_name', list_name); 

        addList(fd); // ë¦¬ìŠ¤íŠ¸ ì¶”ê°€ í•¨ìˆ˜ í˜¸ì¶œ

        // ì¶”ê°€ ë²„íŠ¼ í´ë¦­ í›„ ëª¨ë‹¬ ë‹«ê¸°
        modal.style.display = "none";
        document.body.style.overflowY = "visible";

        setTimeout(() => {
            location.reload();
        }, 100);
    });

    // ëª¨ë“  ë¦¬ìŠ¤íŠ¸ ë²„íŠ¼ì— ëŒ€í•´ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡
    const listButtons = document.querySelectorAll(".list_button");
    listButtons.forEach((listButton) => {
        listButton.addEventListener('click', () => {
            const listNumber = listButton.dataset.listNumber;
            const url = `/mylist/${listNumber}/`; // ì´ë™í•  URL ì„¤ì •
            window.location.href = url; // URLë¡œ ì´ë™
        });
    });

    
</script>
{% endblock %}